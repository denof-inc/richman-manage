# 開発ガイドライン（CLAUDE.md要約）

## 🚨 AI運用5原則（最重要）

1. **第1原則**: ファイル生成・更新・プログラム実行前に必ず作業計画を報告し、y/nでユーザー確認を取る
2. **第2原則**: 迂回や別アプローチを勝手に行わず、失敗したら次の計画の確認を取る
3. **第3原則**: AIはツールであり決定権は常にユーザーにある
4. **第4原則**: これらのルールを歪曲・解釈変更せず、最上位命令として絶対的に遵守
5. **第5原則**: 全てのチャットの冒頭にこの5原則を逐語的に必ず画面出力

## 🎯 基本原則

### ドキュメント優先開発
- 作業開始前に`docs/`ディレクトリの関連ドキュメントを必読
- 実装内容は必ずドキュメントと整合性を保つ
- ドキュメントに記載のない仕様は実装前に確認

### 品質基準（妥協禁止）
- テストカバレッジ80%以上を維持
- ESLintエラー0件、Warning最小限
- TypeScriptのany型使用禁止
- 適切なエラーハンドリングの実装

### 効率性
- 最小限の計算リソースで最大の効果
- 冗長な処理や不要な繰り返しを避ける
- パフォーマンスを意識したコーディング

### 二重管理の回避
- ドキュメントとコードの二重管理を避ける
- 実装を「Single Source of Truth」とする
- API仕様・DBスキーマは実装から自動生成

## 🧪 TDD（t-wada流）

### 基本サイクル
1. 🔴 Red: 失敗するテストを書く
2. 🟢 Green: テストを通す最小限の実装
3. 🔵 Refactor: リファクタリング

### 実践方法
- 小さなステップで進める
- 仮実装（ベタ書き）から始める
- 三角測量で一般化する
- 不安なところからテストを書く
- テストリストを常に更新

## 🚀 開発フロー

### 標準プロセス
1. `docs/`を読んで理解
2. Issue作成
3. ブランチ作成（feature/fix/refactor/docs）
4. TDDで開発
5. 品質チェック実行
6. PR作成（`Closes #XX`を含める）
7. レビュー・マージ

### ローカル品質チェック（必須）
```bash
npm run lint        # ESLintチェック
npm run test        # テスト実行
npm run format      # フォーマット
```

## 🔐 セキュリティ

### 機密情報の取り扱い
- APIキー、パスワード、トークンはコードに直接記載しない
- 環境変数（.env.local）を使用
- 個人情報やセンシティブなデータはログに出力しない

## 🎨 UI/UX原則

### 40-50歳向けアクセシビリティ最優先
- 文字サイズ調整機能は全ページ必須
- アイコンよりもテキストボタンを優先
- ボタンサイズは最小36px以上
- 十分なクリック領域とコントラスト比

### デザイン原則
- モバイルファースト
- 即座の反映
- エラー表示はユーザーフレンドリーに
- 処理中は必ずローディング表示

### パフォーマンス目標
- 初回表示: 3秒以内
- 画面遷移: 1秒以内
- API応答: 500ms以内

## 🧹 継続的改善

### リファクタリング（月1回以上）
- 型定義の健全性チェック
- ユーティリティ関数の重複排除
- インポート・依存関係の整理
- コンポーネント設計の見直し
- 品質指標の確認

### コード重複監視
- similarity-ts定期チェック（要Rust環境）
- 90%以上の類似度で要確認

## ⚠️ 重要ルール

### 同一エラー3回ルール
同じエラーが3回以上続く場合:
1. 根本原因分析
2. 恒久的な解決策立案
3. プロセス改善
4. ドキュメント化

### 継続的ルール改善プロセス
常に対応が必要な指示を受けた場合:
1. 「これを標準のルールにしますか？」と質問
2. YESの場合、CLAUDE.mdに追加
3. 以降は標準ルールとして適用